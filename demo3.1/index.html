<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { max-width: 500px; margin: auto; padding: 20px; }
        input, button { width: 100%; margin-top: 5px; padding: 10px; }
        pre { background: #f4f4f4; padding: 10px; }
        .product-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>ƒêƒÉng k√Ω</h2>
        <input type="text" id="reg-username" placeholder="Username">
        <input type="email" id="reg-email" placeholder="Email">
        <input type="password" id="reg-password" placeholder="Password">
        <button onclick="register()">ƒêƒÉng k√Ω</button>
        <pre id="reg-result"></pre>

        <h2>ƒêƒÉng nh·∫≠p</h2>
        <input type="email" id="login-email" placeholder="Email">
        <input type="password" id="login-password" placeholder="Password">
        <button onclick="login()">ƒêƒÉng nh·∫≠p</button>
        <pre id="login-result"></pre>

        <h2>Get All Users</h2>
        <button onclick="getAllUsers()">Get All</button>
        <pre id="all-users"></pre>

        <h2>Get Current Users</h2>
        <button onclick="getCurrentUser()">Get Current</button>
        <pre id="current-user"></pre>

        <h2>Find User By Name</h2>
        <input type="text" id="search-username" placeholder="Enter username">
        <button onclick="getUserByName()">Find User</button>
        <pre id="user-result"></pre>

        <h2>T·∫°o danh m·ª•c</h2>
        <input type="text" id="cat-name" placeholder="T√™n danh m·ª•c">
        <button onclick="createCategory()">T·∫°o danh m·ª•c</button>
        <pre id="cat-result"></pre>

        <h2>Get All Categories</h2>
        <button onclick="getAllCategories()">Get All</button>
        <pre id="all-categories"></pre>

        <h2>Find Category By Name</h2>
        <input type="text" id="search-category" placeholder="Enter category name">
        <button onclick="getCategoryByName()">Find Category</button>
        <pre id="category-result"></pre>

        <h2>T·∫°o s·∫£n ph·∫©m</h2>
        <input type="text" id="prod-name" placeholder="T√™n s·∫£n ph·∫©m">
        <input type="number" id="prod-category" placeholder="ID danh m·ª•c">
        <textarea id="prod-detail" placeholder="Chi ti·∫øt s·∫£n ph·∫©m"></textarea>
        <button onclick="createProduct()">T·∫°o s·∫£n ph·∫©m</button>
        <pre id="prod-result"></pre>


        <h2>C·∫≠p nh·∫≠t s·∫£n ph·∫©m</h2>
        <input type="number" id="update-prod-id" placeholder="ID s·∫£n ph·∫©m">
        <input type="text" id="update-prod-name" placeholder="T√™n s·∫£n ph·∫©m m·ªõi">
        <input type="number" id="update-prod-category" placeholder="ID danh m·ª•c m·ªõi">
        <textarea id="update-prod-detail" placeholder="Chi ti·∫øt s·∫£n ph·∫©m m·ªõi"></textarea>
        <button onclick="updateProduct()">C·∫≠p nh·∫≠t s·∫£n ph·∫©m</button>
        <pre id="update-prod-result"></pre>


        <h2>üìå L·∫•y to√†n b·ªô s·∫£n ph·∫©m</h2>
        <button onclick="getAllProducts()">L·∫•y danh s√°ch</button>
        <pre id="all-products"></pre>

        <h2>T·∫°o chia s·∫ª</h2>
        <input type="number" id="shared-user-invt" placeholder="ID ng∆∞·ªùi m·ªùi">
        <input type="number" id="shared-product-id" placeholder="ID s·∫£n ph·∫©m">
        <input type="text" id="shared-permision" placeholder="Permission (default 'view')">
        <button onclick="createShared()">T·∫°o chia s·∫ª</button>
        <pre id="shared-result"></pre>
    
        <h2>üìå L·∫•y t·∫•t c·∫£ chia s·∫ª</h2>
        <button onclick="getAllShared()">L·∫•y t·∫•t c·∫£ chia s·∫ª</button>
        <pre id="all-shared"></pre>
    
        <h2>üìå L·∫•y chia s·∫ª theo ID</h2>
        <input type="number" id="shared-id" placeholder="ID chia s·∫ª">
        <button onclick="getSharedById()">L·∫•y chia s·∫ª</button>
        <pre id="shared-by-id"></pre>
    
        <h2>üìå L·∫•y chia s·∫ª theo Product ID</h2>
        <input type="number" id="shared-product-id-filter" placeholder="Product ID">
        <button onclick="getSharedByProductId()">L·∫•y chia s·∫ª</button>
        <pre id="shared-by-product-id"></pre>
    
        <h2>‚ùå Xo√° chia s·∫ª</h2>
        <input type="number" id="delete-shared-id" placeholder="ID chia s·∫ª c·∫ßn xo√°">
        <button onclick="deleteShared()">Xo√° chia s·∫ª</button>
        <pre id="delete-shared-result"></pre>

    
        <h2>üîé T√¨m s·∫£n ph·∫©m theo t√™n</h2>
        <input type="text" id="search-product" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m">
        <button onclick="getProductByName()">T√¨m ki·∫øm</button>
        <pre id="product-result"></pre>

        <h2>üìå L·∫•y s·∫£n ph·∫©m theo ID</h2>
        <input type="number" id="product-id" placeholder="Nh·∫≠p ID s·∫£n ph·∫©m">
        <button onclick="getProductById()">L·∫•y s·∫£n ph·∫©m</button>
        <pre id="product-result"></pre>

        <h2>üìå L·∫•y s·∫£n ph·∫©m theo ID User</h2>
        <!-- <input type="number" id="product-id" placeholder="Nh·∫≠p ID s·∫£n ph·∫©m"> -->
        <button onclick="getProductByCreated()">L·∫•y s·∫£n ph·∫©m</button>
        <pre id="product-result"></pre>
        
        <!-- T·∫°o comment -->
         
        <!-- <h2>T·∫°o b√¨nh lu·∫≠n</h2>
        <input type="number" id="create-comment-product-id" placeholder="ID s·∫£n ph·∫©m">
        <input type="number" id="create-comment-user-id" placeholder="ID ng∆∞·ªùi d√πng">
        <textarea id="create-comment-content" placeholder="N·ªôi dung b√¨nh lu·∫≠n"></textarea>
        <input type="number" id="create-comment-parent-id" placeholder="ID comment cha (n·∫øu l√† tr·∫£ l·ªùi)">
        <button onclick="createComment()">T·∫°o b√¨nh lu·∫≠n</button>
        <pre id="create-comment-result"></pre> -->

        <h2>T·∫°o b√¨nh lu·∫≠n</h2>
        <input type="number" id="haha" placeholder="ID s·∫£n ph·∫©m">
        <input type="number" id="cc" placeholder="ID ng∆∞·ªùi d√πng">
        <textarea id="cl" placeholder="N·ªôi dung b√¨nh lu·∫≠n"></textarea>
        <input type="number" id="hi" placeholder="ID danh m·ª•c">
        <button onclick="createCmt()">T·∫°o b√¨nh lu·∫≠n</button>
        <pre id="cmt-result"></pre>


        <!-- L·∫•y comment theo s·∫£n ph·∫©m -->
        <h2>L·∫•y b√¨nh lu·∫≠n theo s·∫£n ph·∫©m</h2>
        <input type="number" id="comment-product-id" placeholder="ID s·∫£n ph·∫©m">
        <button onclick="getCommentsByProduct()">L·∫•y b√¨nh lu·∫≠n</button>
        <pre id="comment-result"></pre>

        <!-- X√≥a comment -->
        <h2>X√≥a b√¨nh lu·∫≠n</h2>
        <input type="number" id="comment-id" placeholder="ID b√¨nh lu·∫≠n">
        <button onclick="deleteComment()">X√≥a b√¨nh lu·∫≠n</button>
        <pre id="comment-result"></pre>



    </div>
    <script>
        let token = localStorage.getItem("token") || "";
    console.log("Loaded token:", token);
	var userstored = JSON.parse(localStorage.getItem("user"));
    console.log("Loaded user:", userstored);
    async function fetchData(url, method = "GET", body = null, auth = false) {
    let headers = { "Content-Type": "application/json" };
    let savedToken = localStorage.getItem("token");
    if (auth && savedToken) headers["Authorization"] = "Bearer " + savedToken;

    let options = { method, headers };
    if (body) options.body = JSON.stringify(body);

    console.log("üõ† Sending Request:", { url, method, headers, body });

    try {
        let res = await fetch(url, options);

        if (!res.ok) {
            console.error(`‚ùå HTTP Error: ${res.status} ${res.statusText}`);
            return { error: `HTTP Error ${res.status}` };
        }

        // ‚úÖ Chuy·ªÉn sang await res.json() ƒë·ªÉ ƒë·∫£m b·∫£o d·ªØ li·ªáu kh√¥ng b·ªã r·ªóng
        let data = await res.json();  

        console.log("üì© Response (Parsed):", data);

        return data;
    } catch (err) {
        console.error("‚ùå Request failed:", err);
        return { error: "Request failed" };
    }
}


// ‚úÖ ƒêƒÉng k√Ω
async function register() {
    let data = await fetchData("http://localhost:8000/register", "POST", {
        username: document.getElementById("reg-username").value,
        email: document.getElementById("reg-email").value,
        password: document.getElementById("reg-password").value
    });

    document.getElementById("reg-result").innerText = JSON.stringify(data, null, 2);
}
// ‚úÖ ƒêƒÉng nh·∫≠p
async function login() {
    let data = await fetchData("http://localhost:8000/login", "POST", {
        email: document.getElementById("login-email").value,
        password: document.getElementById("login-password").value
    });

    console.log("üì© Full Response:", data);  // Ki·ªÉm tra ph·∫£n h·ªìi t·ª´ API

    if (data && data.token) {
    localStorage.setItem("token", data.token);
    console.log("‚úÖ Token ƒë√£ l∆∞u:", localStorage.getItem("token"));
    } else {
        console.error("‚ùå Kh√¥ng t√¨m th·∫•y token. Response:", data);
    }


    document.getElementById("login-result").innerText = JSON.stringify(data, null, 2);
}
// ‚úÖ L·∫•y t·∫•t c·∫£ user (c·∫ßn token)
async function getAllUsers() {
    let data = await fetchData("http://localhost:8000/users", "GET", null, true);
    document.getElementById("all-users").innerText = JSON.stringify(data, null, 2);
}
// ‚úÖ L·∫•y th√¥ng tin user hi·ªán t·∫°i (c·∫ßn token)
async function getCurrentUser() {
    let data = await fetchData("http://localhost:8000/users?current=true", "GET", null, true);
    document.getElementById("current-user").innerText = JSON.stringify(data, null, 2);
}
// ‚úÖ T√¨m user theo t√™n
async function getUserByName() {
    let username = document.getElementById("search-username").value;
    let data = await fetchData(`http://localhost:8000/users?email=${username}`, "GET", null, true);
}
// ‚úÖ T·∫°o danh m·ª•c (c·∫ßn token)
async function createCategory() {
    let data = await fetchData("http://localhost:8000/category", "POST", {
        name: document.getElementById("cat-name").value
    }, true);

    document.getElementById("cat-result").innerText = JSON.stringify(data, null, 2);
}

// ‚úÖ L·∫•y t·∫•t c·∫£ danh m·ª•c
async function getAllCategories() {
    let data = await fetchData("http://localhost:8000/category", "GET", null, true);
    document.getElementById("all-categories").innerText = JSON.stringify(data, null, 2);
}

// ‚úÖ T√¨m danh m·ª•c theo t√™n
async function getCategoryByName() {
    let name = document.getElementById("search-category").value;
    let data = await fetchData(`http://localhost:8000/category?name=${name}`, "GET", null, true);
    document.getElementById("category-result").innerText = JSON.stringify(data, null, 2);
}

async function createProduct() {
    let data = await fetchData("http://localhost:8000/product", "POST", {
        name: document.getElementById("prod-name").value,
        category_id: document.getElementById("prod-category").value,
        detail: document.getElementById("prod-detail").value
    }, true);

    document.getElementById("prod-result").innerText = JSON.stringify(data, null, 2);
}
// ‚úÖ C·∫≠p nh·∫≠t s·∫£n ph·∫©m
async function updateProduct() {
    let data = await fetchData(`http://localhost:8000/product/${document.getElementById("update-prod-id").value}`, "PUT", {
        name: document.getElementById("update-prod-name").value,
        category_id: document.getElementById("update-prod-category").value,
        detail: document.getElementById("update-prod-detail").value
    }, true);

    document.getElementById("update-prod-result").innerText = JSON.stringify(data, null, 2);
}
 // ‚úÖ L·∫•y to√†n b·ªô s·∫£n ph·∫©m
        async function getAllProducts() {
            let data = await fetchData("http://localhost:8000/products", "GET", null, true);
            document.getElementById("all-products").innerText = JSON.stringify(data, null, 2);
        }
        // ‚úÖ T√¨m s·∫£n ph·∫©m theo t√™n
        async function getProductByName() {
            let name = document.getElementById("search-product").value.trim();
            if (!name) {
                alert("Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!");
                return;
            }
            let data = await fetchData(`http://localhost:8000/products?name=${name}`, "GET", null, true);
            document.getElementById("product-result").innerText = JSON.stringify(data, null, 2);
        }
        // ‚úÖ G·ªçi h√†m l·∫•y t·∫•t c·∫£ s·∫£n ph·∫©m khi trang t·∫£i xong
        document.addEventListener("DOMContentLoaded", getAllProducts);
                // ‚úÖ L·∫•y s·∫£n ph·∫©m theo ID
        async function getProductById() {
            let productId = document.getElementById("product-id").value.trim();
            if (!productId) {
                alert("Vui l√≤ng nh·∫≠p ID s·∫£n ph·∫©m!");
                return;
            }
            
            let data = await fetchData(`http://localhost:8000/product/${productId}`, "GET", null, true);
            document.getElementById("product-result").innerText = JSON.stringify(data, null, 2);
        }

        async function getProductByCreated() {
            let userid = userstored;
            console.log("user id",userid.id)
            if (!userid) {
                alert("Kh√¥ng l·∫•y ƒë∆∞·ª£c id ng∆∞·ªùi d√πng");
                return;
            }
            
            let data = await fetchData(`http://localhost:8000/productuser/${userid.id}`, "GET", null, true);
            document.getElementById("product-result").innerText = JSON.stringify(data, null, 2);
        }

        
        async function createCmt() {
            let data = await fetchData("http://localhost:8000/comments", "POST", {
                        product_id: document.getElementById("haha").value,
                        user_id: document.getElementById("cc").value,
                        content: document.getElementById("cl").value,
                        parent_id: document.getElementById("hi").value || null
            }, true);

        }


        // L·∫•y t·∫•t c·∫£ comment c·ªßa 1 s·∫£n ph·∫©m
        async function getCommentsByProduct() {
            let productId = document.getElementById("comment-product-id").value;
            let data = await fetchData(`http://localhost:8000/comments/product/${productId}`, "GET", null, true);

            document.getElementById("comment-result").innerText = JSON.stringify(data, null, 2);
        }

        // Xo√° comment theo ID
        async function deleteComment() {
            let commentId = document.getElementById("comment-id").value;
            let data = await fetchData(`http://localhost:8000/comment/${commentId}`, "DELETE", null, true);

            document.getElementById("comment-result").innerText = JSON.stringify(data, null, 2);
        }

        async function createShared() {
            let data = await fetchData("http://localhost:8000/shared", "POST", {
                user_invt: document.getElementById("shared-user-invt").value,
                product_id: document.getElementById("shared-product-id").value,
                permision: document.getElementById("shared-permision").value || 'view'
            }, true);

            document.getElementById("shared-result").innerText = JSON.stringify(data, null, 2);
        }



        // ‚úÖ L·∫•y t·∫•t c·∫£ chia s·∫ª
        async function getAllShared() {
            let data = await fetchData("http://localhost:8000/shared", "GET", null, true);
            document.getElementById("all-shared").innerText = JSON.stringify(data, null, 2);
        }

        // ‚úÖ L·∫•y chia s·∫ª theo ID
        async function getSharedById() {
            let sharedId = document.getElementById("shared-id").value;
            let data = await fetchData(`http://localhost:8000/shared/${sharedId}`, "GET", null, true);
            document.getElementById("shared-by-id").innerText = JSON.stringify(data, null, 2);
        }

        // ‚úÖ L·∫•y chia s·∫ª theo Product ID
        async function getSharedByProductId() {
            let productId = document.getElementById("shared-product-id-filter").value;
            let data = await fetchData(`http://localhost:8000/shared/product/${productId}`, "GET", null, true);
            document.getElementById("shared-by-product-id").innerText = JSON.stringify(data, null, 2);
        }

        // ‚úÖ Xo√° chia s·∫ª
        async function deleteShared() {
            let sharedId = document.getElementById("delete-shared-id").value;
            let data = await fetchData(`http://localhost:8000/shared/${sharedId}`, "DELETE", null, true);
            document.getElementById("delete-shared-result").innerText = JSON.stringify(data, null, 2);
        }



    

    </script>
</body>
</html>
